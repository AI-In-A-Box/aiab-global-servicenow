<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_page">
    <sys_ui_page action="DELETE">
        <category>general</category>
        <client_script><![CDATA[$j(document).ready(function () {
	try{
		iframeHelper.hideCloseButton();
		iframeHelper.autoResize();
	} catch(error){
		//
	}
    $j("#response").on("change", function () {
        $j(this).css('height', 'auto');
        $j(this).css('height', this.scrollHeight + 'px');
        try{
			iframeHelper.setHeight(this.scrollHeight);
		} catch(error){
			//
		}
    });
    $j('#stop').click(function () {
        cancelInference();
    });
    $j('#ask').click(function () {
        generateResponse();
    });
    $j('#cancel').click(function () {
		try{
        iframeHelper.cancel();
		GlideModal.get().destroy();

		}catch(error){
			//
		}
    });

    var url = new URL(window.location.href);
    var table = url.searchParams.get("table") || document.getElementById('table').value;
    var record = url.searchParams.get("record") || document.getElementById('record').value;
    var watchRecord = function (table, filter, callback) {
        function getFilterString(filter) {
            return btoa(filter.replace(/\^EQ/g, '').replace(/\^ORDERBY(?:DESC)?[^^]*/g, '').replace(/^GOTO/, '')).replace(/=/g, '-');
        }
        if (table === "sys_amb_message" || table.startsWith("sys_rw")) return null;
        var amb = top.window.top.g_ambClient;
        var watcherChannel = amb.getChannel('/rw/default/' + table + '/' + getFilterString(filter));
        watcherChannel.subscribe(callback);
        amb.connect();
        return watcherChannel;
    };
    var cancelInference = function () {
        var ga = new GlideAjax('aiabAjax');
        ga.addParam('sysparm_name', 'cancelAIInference');
        ga.addParam('sysparm_sys_id', $j("#inference").val());
        ga.getXMLAnswer(function (response) {

        });
    };
    var generateResponse = function () {
        //disable regenerate button
        $j('#ask').prop('disabled', true);
        $j('#stop').prop('disabled', false);
        var ga = new GlideAjax('aiabAjax');
        ga.addParam('sysparm_name', 'createAIInferenceAskRecord');
        ga.addParam('sysparm_sys_id', record);
        ga.addParam('sysparm_table', table);
        ga.addParam('sysparm_prompt', $j("#prompt").val());
        ga.getXMLAnswer(function (response) {
            $j("#inference").val(response);
            var queryToWatch = 'sys_id=' + response;
            watchRecord('u_ai_inference', queryToWatch, function (message) {
                var response = message.data.record.u_response;
                //console.log({record:message.data.record});
                var responseFound = typeof response !== 'undefined';
                if (responseFound) {
                    var responseValue = response.display_value;
                    $j("#response").val(responseValue);
					try{
                    iframeHelper.setHeight($j("#p-response")[0].scrollHeight + 40);
					}catch(error){
						//
					}
                }
                var state = message.data.record.u_state;
                var stateFound = typeof state !== 'undefined';
                if (stateFound) {
                    var stateValue = state.value;
                    if (stateValue === 'finished' || stateValue === 'cancelled') {
                        $j('#ask').prop('disabled', false);
                        $j('#stop').prop('disabled', true);
                    }
                }
            });
        });
    };
});]]></client_script>
        <description/>
        <direct>false</direct>
        <endpoint/>
        <html><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false"
    xmlns:j="jelly:core"
    xmlns:g="glide"
    xmlns:j2="null"
    xmlns:g2="null">
    <g:requires name="iframeHelper.jsdbx"></g:requires>
	<j:set var="jvar_table" value="${sysparm_table}"/>
	<j:set var="jvar_record" value="${sysparm_record}"/>
    <div class="form-group">
        <label for="prompt">Ask Away</label>
        <textarea class="form-control" id="prompt" name="prompt" style="height: auto;">
        ${prompt}
        </textarea>
		<label for="response">Response</label>
		<textarea class="form-control" id="response" name="response" style="height: auto;" rows="15">
        ${response}
        </textarea>
        <label for="inference" class="hidden">Inference</label>
        <input id="inference" class="form-control hidden" />
		<label for="table" class="hidden">Table</label>
        <input id="table" class="form-control hidden" value="${jvar_table}" />
		<label for="record" class="hidden">Record</label>
        <input id="record" class="form-control hidden" value="${jvar_record}" />
    </div>
    <div style="display:flex; gap: 4px;">
        <button id="ask" class="btn btn-default">Ask</button>
        <button id="stop" class="btn btn-danger">
            <span id="spinner" class="glyphicon glyphicon-refresh glyphicon-spin" style="display:none;"></span>
		Stop
        </button>
        <button id="cancel" class="btn btn-primary">Close</button>
    </div>

</j:jelly>]]></html>
        <name>aiiab.ask</name>
        <processing_script/>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-01-15 00:51:07</sys_created_on>
        <sys_id>3e64a0ae83cb52107f36c5b5eeaad333</sys_id>
        <sys_mod_count>11</sys_mod_count>
        <sys_name>aiiab.ask</sys_name>
        <sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016">0439d1f593948210071230a97bba1016</sys_package>
        <sys_policy/>
        <sys_scope display_value="AI in a Box">0439d1f593948210071230a97bba1016</sys_scope>
        <sys_update_name>sys_ui_page_3e64a0ae83cb52107f36c5b5eeaad333</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-01-15 06:25:30</sys_updated_on>
    </sys_ui_page>
    <sys_update_version action="INSERT_OR_UPDATE">
        <action>DELETE</action>
        <application display_value="AI in a Box">0439d1f593948210071230a97bba1016</application>
        <file_path/>
        <instance_id>3e01943a1b79f9901024eb9b2d4bcb05</instance_id>
        <instance_name>dev184755</instance_name>
        <name>sys_ui_page_3e64a0ae83cb52107f36c5b5eeaad333</name>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_page"&gt;&lt;sys_ui_page action="INSERT_OR_UPDATE"&gt;&lt;category&gt;general&lt;/category&gt;&lt;client_script&gt;&lt;![CDATA[$j(document).ready(function () {
	try{
		iframeHelper.hideCloseButton();
		iframeHelper.autoResize();
	} catch(error){
		//
	}
    $j("#response").on("change", function () {
        $j(this).css('height', 'auto');
        $j(this).css('height', this.scrollHeight + 'px');
        try{
			iframeHelper.setHeight(this.scrollHeight);
		} catch(error){
			//
		}
    });
    $j('#stop').click(function () {
        cancelInference();
    });
    $j('#ask').click(function () {
        generateResponse();
    });
    $j('#cancel').click(function () {
		try{
        iframeHelper.cancel();
		GlideModal.get().destroy();

		}catch(error){
			//
		}
    });

    var url = new URL(window.location.href);
    var table = url.searchParams.get("table") || document.getElementById('table').value;
    var record = url.searchParams.get("record") || document.getElementById('record').value;
    var watchRecord = function (table, filter, callback) {
        function getFilterString(filter) {
            return btoa(filter.replace(/\^EQ/g, '').replace(/\^ORDERBY(?:DESC)?[^^]*/g, '').replace(/^GOTO/, '')).replace(/=/g, '-');
        }
        if (table === "sys_amb_message" || table.startsWith("sys_rw")) return null;
        var amb = top.window.top.g_ambClient;
        var watcherChannel = amb.getChannel('/rw/default/' + table + '/' + getFilterString(filter));
        watcherChannel.subscribe(callback);
        amb.connect();
        return watcherChannel;
    };
    var cancelInference = function () {
        var ga = new GlideAjax('aiabAjax');
        ga.addParam('sysparm_name', 'cancelAIInference');
        ga.addParam('sysparm_sys_id', $j("#inference").val());
        ga.getXMLAnswer(function (response) {

        });
    };
    var generateResponse = function () {
        //disable regenerate button
        $j('#ask').prop('disabled', true);
        $j('#stop').prop('disabled', false);
        var ga = new GlideAjax('aiabAjax');
        ga.addParam('sysparm_name', 'createAIInferenceAskRecord');
        ga.addParam('sysparm_sys_id', record);
        ga.addParam('sysparm_table', table);
        ga.addParam('sysparm_prompt', $j("#prompt").val());
        ga.getXMLAnswer(function (response) {
            $j("#inference").val(response);
            var queryToWatch = 'sys_id=' + response;
            watchRecord('u_ai_inference', queryToWatch, function (message) {
                var response = message.data.record.u_response;
                //console.log({record:message.data.record});
                var responseFound = typeof response !== 'undefined';
                if (responseFound) {
                    var responseValue = response.display_value;
                    $j("#response").val(responseValue);
					try{
                    iframeHelper.setHeight($j("#p-response")[0].scrollHeight + 40);
					}catch(error){
						//
					}
                }
                var state = message.data.record.u_state;
                var stateFound = typeof state !== 'undefined';
                if (stateFound) {
                    var stateValue = state.value;
                    if (stateValue === 'finished' || stateValue === 'cancelled') {
                        $j('#ask').prop('disabled', false);
                        $j('#stop').prop('disabled', true);
                    }
                }
            });
        });
    };
});]]&gt;&lt;/client_script&gt;&lt;description/&gt;&lt;direct&gt;false&lt;/direct&gt;&lt;endpoint/&gt;&lt;html&gt;&lt;![CDATA[&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;j:jelly trim="false"
    xmlns:j="jelly:core"
    xmlns:g="glide"
    xmlns:j2="null"
    xmlns:g2="null"&gt;
    &lt;g:requires name="iframeHelper.jsdbx"&gt;&lt;/g:requires&gt;
	&lt;j:set var="jvar_table" value="${sysparm_table}"/&gt;
	&lt;j:set var="jvar_record" value="${sysparm_record}"/&gt;
    &lt;div class="form-group"&gt;
        &lt;label for="prompt"&gt;Ask Away&lt;/label&gt;
        &lt;textarea class="form-control" id="prompt" name="prompt" style="height: auto;"&gt;
        ${prompt}
        &lt;/textarea&gt;
		&lt;label for="response"&gt;Response&lt;/label&gt;
		&lt;textarea class="form-control" id="response" name="response" style="height: auto;" rows="15"&gt;
        ${response}
        &lt;/textarea&gt;
        &lt;label for="inference" class="hidden"&gt;Inference&lt;/label&gt;
        &lt;input id="inference" class="form-control hidden" /&gt;
		&lt;label for="table" class="hidden"&gt;Table&lt;/label&gt;
        &lt;input id="table" class="form-control hidden" value="${jvar_table}" /&gt;
		&lt;label for="record" class="hidden"&gt;Record&lt;/label&gt;
        &lt;input id="record" class="form-control hidden" value="${jvar_record}" /&gt;
    &lt;/div&gt;
    &lt;div style="display:flex; gap: 4px;"&gt;
        &lt;button id="ask" class="btn btn-default"&gt;Ask&lt;/button&gt;
        &lt;button id="stop" class="btn btn-danger"&gt;
            &lt;span id="spinner" class="glyphicon glyphicon-refresh glyphicon-spin" style="display:none;"&gt;&lt;/span&gt;
		Stop
        &lt;/button&gt;
        &lt;button id="cancel" class="btn btn-primary"&gt;Close&lt;/button&gt;
    &lt;/div&gt;

&lt;/j:jelly&gt;]]&gt;&lt;/html&gt;&lt;name&gt;aiiab.ask&lt;/name&gt;&lt;processing_script/&gt;&lt;sys_class_name&gt;sys_ui_page&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2025-01-15 00:51:07&lt;/sys_created_on&gt;&lt;sys_id&gt;3e64a0ae83cb52107f36c5b5eeaad333&lt;/sys_id&gt;&lt;sys_mod_count&gt;11&lt;/sys_mod_count&gt;&lt;sys_name&gt;aiiab.ask&lt;/sys_name&gt;&lt;sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016"&gt;0439d1f593948210071230a97bba1016&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="AI in a Box"&gt;0439d1f593948210071230a97bba1016&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_page_3e64a0ae83cb52107f36c5b5eeaad333&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2025-01-15 06:25:30&lt;/sys_updated_on&gt;&lt;/sys_ui_page&gt;&lt;/record_update&gt;</payload>
        <payload_hash>-1448361141</payload_hash>
        <record_name>aiiab.ask</record_name>
        <reverted_from/>
        <source>ee32c045831afe104d4fccb6feaad328</source>
        <source_table>sys_update_set</source_table>
        <state>previous</state>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-05 16:06:21</sys_created_on>
        <sys_id>b6428c45831afe104d4fccb6feaad39a</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_recorded_at>19b8ee8d3860000001</sys_recorded_at>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-05 16:06:21</sys_updated_on>
        <type>UI Page</type>
        <update_guid>c07234aff1e722104896c966a4fbfe21</update_guid>
        <update_guid_history>c07234aff1e722104896c966a4fbfe21:-1448361141</update_guid_history>
    </sys_update_version>
    <sys_metadata_delete action="INSERT_OR_UPDATE">
        <sys_audit_delete/>
        <sys_class_name>sys_metadata_delete</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-22 21:43:35</sys_created_on>
        <sys_db_object display_value="" name="sys_ui_page">sys_ui_page</sys_db_object>
        <sys_id>09296b8bc5674c2d89b61ff16d6e0db9</sys_id>
        <sys_metadata>3e64a0ae83cb52107f36c5b5eeaad333</sys_metadata>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>aiiab.ask</sys_name>
        <sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016">0439d1f593948210071230a97bba1016</sys_package>
        <sys_parent/>
        <sys_policy/>
        <sys_scope display_value="AI in a Box">0439d1f593948210071230a97bba1016</sys_scope>
        <sys_scope_delete display_value="">c1a48f6b4a924506a5b1a6becbc665a1</sys_scope_delete>
        <sys_update_name>sys_ui_page_3e64a0ae83cb52107f36c5b5eeaad333</sys_update_name>
        <sys_update_version display_value="sys_ui_page_3e64a0ae83cb52107f36c5b5eeaad333">b6428c45831afe104d4fccb6feaad39a</sys_update_version>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-22 21:43:35</sys_updated_on>
    </sys_metadata_delete>
</record_update>
