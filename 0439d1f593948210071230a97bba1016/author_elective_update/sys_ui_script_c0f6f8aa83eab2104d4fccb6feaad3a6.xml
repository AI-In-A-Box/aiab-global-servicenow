<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_script">
    <sys_ui_script action="DELETE">
        <active>false</active>
        <description>Floating purple chat button for UI16 that opens the SP widget in a popup container</description>
        <global>true</global>
        <ignore_in_now_experience>false</ignore_in_now_experience>
        <name>AIAB Chat Button (SP Widget)</name>
        <script><![CDATA[// AIAB Chat Button (SP Widget) - Floating button for UI16
// Only loads on /now/nav/ui/classic or /<table>.do pages
// Button injected into parent window, opens SP widget in container
(function() {
  'use strict';
  
  var path = window.location.pathname;
  
  // Only allow on specific pages:
  // 1. /now/nav/ui/classic (UI16 in Workspace shell)
  // 2. /<table>.do pages (direct form/list access)
  var isClassicNav = path.indexOf('/now/nav/ui/classic') === 0;
  var isTableDo = /^\/[a-z_]+\.do/i.test(path);
  
  if (!isClassicNav && !isTableDo) {
    return;
  }
  
  // Determine target - inject into top window for UI16
  var targetDoc = document;
  var targetWin = window;
  
  if (window !== window.top) {
    try {
      targetDoc = window.top.document;
      targetWin = window.top;
    } catch (e) {
      return;
    }
  }
  
  // Don't inject twice
  if (targetDoc.getElementById('aiab-chat-button')) {
    return;
  }
  
  // Size constants
  var BUTTON_SIZE = 56;
  var CHAT_WIDTH = 420;
  var CHAT_HEIGHT = 550;
  var CHAT_WIDTH_WIDE = 650;
  var CHAT_HEIGHT_WIDE = 650;
  
  var isOpen = false;
  var isWide = false;
  var chatContainer = null;
  var chatIframe = null;
  
  // Get current record context from g_form
  function getRecordContext() {
    var table = '';
    var sysId = '';
    var display = '';
    
    if (typeof g_form !== 'undefined') {
      try {
        table = g_form.getTableName() || '';
        sysId = g_form.getUniqueValue() || '';
        display = g_form.getValue('number') || g_form.getValue('name') || '';
      } catch (e) {}
    }
    
    if ((!table || !sysId) && targetDoc.getElementById('gsft_main')) {
      try {
        var mainFrame = targetDoc.getElementById('gsft_main').contentWindow;
        if (mainFrame && mainFrame.g_form) {
          table = mainFrame.g_form.getTableName() || '';
          sysId = mainFrame.g_form.getUniqueValue() || '';
          display = mainFrame.g_form.getValue('number') || mainFrame.g_form.getValue('name') || '';
        }
      } catch (e) {}
    }
    
    return { table: table, sysId: sysId, display: display };
  }
  
  // Build SP URL - use spa=1 to remove header/footer chrome
  function buildUrl() {
    var ctx = getRecordContext();
    var url = '/$sp.do?id=aiab_chat&spa=1&embedded=true';
    if (ctx.table) url += '&table=' + encodeURIComponent(ctx.table);
    if (ctx.sysId) url += '&sys_id=' + encodeURIComponent(ctx.sysId);
    if (ctx.display) url += '&display=' + encodeURIComponent(ctx.display);
    return url;
  }
  
  // Create the floating button
  function createButton() {
    var btn = targetDoc.createElement('button');
    btn.id = 'aiab-chat-button';
    btn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>';
    btn.title = 'AI Chat';
    btn.style.cssText = [
      'position: fixed',
      'bottom: 20px',
      'right: 20px',
      'width: ' + BUTTON_SIZE + 'px',
      'height: ' + BUTTON_SIZE + 'px',
      'border-radius: 50%',
      'border: none',
      'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      'color: white',
      'cursor: pointer',
      'box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4)',
      'z-index: 10000',
      'display: flex',
      'align-items: center',
      'justify-content: center',
      'transition: transform 0.2s, box-shadow 0.2s'
    ].join(';');
    
    btn.onmouseenter = function() {
      btn.style.transform = 'scale(1.1)';
      btn.style.boxShadow = '0 6px 16px rgba(102, 126, 234, 0.5)';
    };
    btn.onmouseleave = function() {
      btn.style.transform = 'scale(1)';
      btn.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.4)';
    };
    
    btn.onclick = toggleChat;
    
    targetDoc.body.appendChild(btn);
    return btn;
  }
  
  // Create the chat container with iframe
  function createChatContainer() {
    var container = targetDoc.createElement('div');
    container.id = 'aiab-chat-container';
    container.style.cssText = [
      'position: fixed',
      'bottom: 90px',
      'right: 20px',
      'width: ' + CHAT_WIDTH + 'px',
      'height: ' + CHAT_HEIGHT + 'px',
      'border-radius: 12px',
      'box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2)',
      'z-index: 9999',
      'display: none',
      'overflow: hidden',
      'background: white'
    ].join(';');
    
    var iframe = targetDoc.createElement('iframe');
    iframe.id = 'aiab-chat-iframe';
    iframe.style.cssText = 'width: 100%; height: 100%; border: none; display: block;';
    
    container.appendChild(iframe);
    targetDoc.body.appendChild(container);
    
    chatIframe = iframe;
    return container;
  }
  
  // Update container size
  function updateSize() {
    if (!chatContainer) return;
    var w = isWide ? CHAT_WIDTH_WIDE : CHAT_WIDTH;
    var h = isWide ? CHAT_HEIGHT_WIDE : CHAT_HEIGHT;
    chatContainer.style.width = w + 'px';
    chatContainer.style.height = h + 'px';
  }
  
  // Update button icon
  function updateButtonIcon() {
    var btn = targetDoc.getElementById('aiab-chat-button');
    if (!btn) return;
    
    if (isOpen) {
      btn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
    } else {
      btn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>';
    }
  }
  
  // Toggle chat open/closed
  function toggleChat() {
    if (!chatContainer) {
      chatContainer = createChatContainer();
    }
    
    isOpen = !isOpen;
    
    if (isOpen) {
      // Load SP widget with embedded=true and spa=1 (minimal chrome)
      chatIframe.src = buildUrl();
      chatContainer.style.display = 'block';
    } else {
      chatContainer.style.display = 'none';
      isWide = false;
      updateSize();
    }
    
    updateButtonIcon();
  }
  
  // Listen for resize messages from the widget
  targetWin.addEventListener('message', function(event) {
    if (!event.data || !event.data.type) return;
    
    if (event.data.type === 'aiab-resize') {
      isWide = event.data.wide;
      updateSize();
    }
  });
  
  // Initialize
  createButton();
})();]]></script>
        <script_name/>
        <sys_class_name>sys_ui_script</sys_class_name>
        <sys_created_by>opencode</sys_created_by>
        <sys_created_on>2026-01-22 22:02:56</sys_created_on>
        <sys_id>c0f6f8aa83eab2104d4fccb6feaad3a6</sys_id>
        <sys_mod_count>9</sys_mod_count>
        <sys_name>AIAB Chat Button (SP Widget)</sys_name>
        <sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016">0439d1f593948210071230a97bba1016</sys_package>
        <sys_policy/>
        <sys_scope display_value="AI in a Box">0439d1f593948210071230a97bba1016</sys_scope>
        <sys_update_name>sys_ui_script_c0f6f8aa83eab2104d4fccb6feaad3a6</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-22 22:33:01</sys_updated_on>
        <ui_type>0</ui_type>
        <use_scoped_format>false</use_scoped_format>
    </sys_ui_script>
    <sys_update_version action="INSERT_OR_UPDATE">
        <action>DELETE</action>
        <application display_value="AI in a Box">0439d1f593948210071230a97bba1016</application>
        <file_path/>
        <instance_id>3e01943a1b79f9901024eb9b2d4bcb05</instance_id>
        <instance_name>dev184755</instance_name>
        <name>sys_ui_script_c0f6f8aa83eab2104d4fccb6feaad3a6</name>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sys_ui_script"&gt;&lt;sys_ui_script action="INSERT_OR_UPDATE"&gt;&lt;active&gt;false&lt;/active&gt;&lt;description&gt;Floating purple chat button for UI16 that opens the SP widget in a popup container&lt;/description&gt;&lt;global&gt;true&lt;/global&gt;&lt;ignore_in_now_experience&gt;false&lt;/ignore_in_now_experience&gt;&lt;name&gt;AIAB Chat Button (SP Widget)&lt;/name&gt;&lt;script&gt;&lt;![CDATA[// AIAB Chat Button (SP Widget) - Floating button for UI16
// Only loads on /now/nav/ui/classic or /&lt;table&gt;.do pages
// Button injected into parent window, opens SP widget in container
(function() {
  'use strict';
  
  var path = window.location.pathname;
  
  // Only allow on specific pages:
  // 1. /now/nav/ui/classic (UI16 in Workspace shell)
  // 2. /&lt;table&gt;.do pages (direct form/list access)
  var isClassicNav = path.indexOf('/now/nav/ui/classic') === 0;
  var isTableDo = /^\/[a-z_]+\.do/i.test(path);
  
  if (!isClassicNav &amp;&amp; !isTableDo) {
    return;
  }
  
  // Determine target - inject into top window for UI16
  var targetDoc = document;
  var targetWin = window;
  
  if (window !== window.top) {
    try {
      targetDoc = window.top.document;
      targetWin = window.top;
    } catch (e) {
      return;
    }
  }
  
  // Don't inject twice
  if (targetDoc.getElementById('aiab-chat-button')) {
    return;
  }
  
  // Size constants
  var BUTTON_SIZE = 56;
  var CHAT_WIDTH = 420;
  var CHAT_HEIGHT = 550;
  var CHAT_WIDTH_WIDE = 650;
  var CHAT_HEIGHT_WIDE = 650;
  
  var isOpen = false;
  var isWide = false;
  var chatContainer = null;
  var chatIframe = null;
  
  // Get current record context from g_form
  function getRecordContext() {
    var table = '';
    var sysId = '';
    var display = '';
    
    if (typeof g_form !== 'undefined') {
      try {
        table = g_form.getTableName() || '';
        sysId = g_form.getUniqueValue() || '';
        display = g_form.getValue('number') || g_form.getValue('name') || '';
      } catch (e) {}
    }
    
    if ((!table || !sysId) &amp;&amp; targetDoc.getElementById('gsft_main')) {
      try {
        var mainFrame = targetDoc.getElementById('gsft_main').contentWindow;
        if (mainFrame &amp;&amp; mainFrame.g_form) {
          table = mainFrame.g_form.getTableName() || '';
          sysId = mainFrame.g_form.getUniqueValue() || '';
          display = mainFrame.g_form.getValue('number') || mainFrame.g_form.getValue('name') || '';
        }
      } catch (e) {}
    }
    
    return { table: table, sysId: sysId, display: display };
  }
  
  // Build SP URL - use spa=1 to remove header/footer chrome
  function buildUrl() {
    var ctx = getRecordContext();
    var url = '/$sp.do?id=aiab_chat&amp;spa=1&amp;embedded=true';
    if (ctx.table) url += '&amp;table=' + encodeURIComponent(ctx.table);
    if (ctx.sysId) url += '&amp;sys_id=' + encodeURIComponent(ctx.sysId);
    if (ctx.display) url += '&amp;display=' + encodeURIComponent(ctx.display);
    return url;
  }
  
  // Create the floating button
  function createButton() {
    var btn = targetDoc.createElement('button');
    btn.id = 'aiab-chat-button';
    btn.innerHTML = '&lt;svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;&lt;path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"&gt;&lt;/path&gt;&lt;/svg&gt;';
    btn.title = 'AI Chat';
    btn.style.cssText = [
      'position: fixed',
      'bottom: 20px',
      'right: 20px',
      'width: ' + BUTTON_SIZE + 'px',
      'height: ' + BUTTON_SIZE + 'px',
      'border-radius: 50%',
      'border: none',
      'background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
      'color: white',
      'cursor: pointer',
      'box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4)',
      'z-index: 10000',
      'display: flex',
      'align-items: center',
      'justify-content: center',
      'transition: transform 0.2s, box-shadow 0.2s'
    ].join(';');
    
    btn.onmouseenter = function() {
      btn.style.transform = 'scale(1.1)';
      btn.style.boxShadow = '0 6px 16px rgba(102, 126, 234, 0.5)';
    };
    btn.onmouseleave = function() {
      btn.style.transform = 'scale(1)';
      btn.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.4)';
    };
    
    btn.onclick = toggleChat;
    
    targetDoc.body.appendChild(btn);
    return btn;
  }
  
  // Create the chat container with iframe
  function createChatContainer() {
    var container = targetDoc.createElement('div');
    container.id = 'aiab-chat-container';
    container.style.cssText = [
      'position: fixed',
      'bottom: 90px',
      'right: 20px',
      'width: ' + CHAT_WIDTH + 'px',
      'height: ' + CHAT_HEIGHT + 'px',
      'border-radius: 12px',
      'box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2)',
      'z-index: 9999',
      'display: none',
      'overflow: hidden',
      'background: white'
    ].join(';');
    
    var iframe = targetDoc.createElement('iframe');
    iframe.id = 'aiab-chat-iframe';
    iframe.style.cssText = 'width: 100%; height: 100%; border: none; display: block;';
    
    container.appendChild(iframe);
    targetDoc.body.appendChild(container);
    
    chatIframe = iframe;
    return container;
  }
  
  // Update container size
  function updateSize() {
    if (!chatContainer) return;
    var w = isWide ? CHAT_WIDTH_WIDE : CHAT_WIDTH;
    var h = isWide ? CHAT_HEIGHT_WIDE : CHAT_HEIGHT;
    chatContainer.style.width = w + 'px';
    chatContainer.style.height = h + 'px';
  }
  
  // Update button icon
  function updateButtonIcon() {
    var btn = targetDoc.getElementById('aiab-chat-button');
    if (!btn) return;
    
    if (isOpen) {
      btn.innerHTML = '&lt;svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;&lt;line x1="18" y1="6" x2="6" y2="18"&gt;&lt;/line&gt;&lt;line x1="6" y1="6" x2="18" y2="18"&gt;&lt;/line&gt;&lt;/svg&gt;';
    } else {
      btn.innerHTML = '&lt;svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;&lt;path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"&gt;&lt;/path&gt;&lt;/svg&gt;';
    }
  }
  
  // Toggle chat open/closed
  function toggleChat() {
    if (!chatContainer) {
      chatContainer = createChatContainer();
    }
    
    isOpen = !isOpen;
    
    if (isOpen) {
      // Load SP widget with embedded=true and spa=1 (minimal chrome)
      chatIframe.src = buildUrl();
      chatContainer.style.display = 'block';
    } else {
      chatContainer.style.display = 'none';
      isWide = false;
      updateSize();
    }
    
    updateButtonIcon();
  }
  
  // Listen for resize messages from the widget
  targetWin.addEventListener('message', function(event) {
    if (!event.data || !event.data.type) return;
    
    if (event.data.type === 'aiab-resize') {
      isWide = event.data.wide;
      updateSize();
    }
  });
  
  // Initialize
  createButton();
})();]]&gt;&lt;/script&gt;&lt;script_name/&gt;&lt;sys_class_name&gt;sys_ui_script&lt;/sys_class_name&gt;&lt;sys_created_by&gt;opencode&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2026-01-22 22:02:56&lt;/sys_created_on&gt;&lt;sys_id&gt;c0f6f8aa83eab2104d4fccb6feaad3a6&lt;/sys_id&gt;&lt;sys_mod_count&gt;9&lt;/sys_mod_count&gt;&lt;sys_name&gt;AIAB Chat Button (SP Widget)&lt;/sys_name&gt;&lt;sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016"&gt;0439d1f593948210071230a97bba1016&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="AI in a Box"&gt;0439d1f593948210071230a97bba1016&lt;/sys_scope&gt;&lt;sys_update_name&gt;sys_ui_script_c0f6f8aa83eab2104d4fccb6feaad3a6&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2026-01-22 22:33:01&lt;/sys_updated_on&gt;&lt;ui_type&gt;0&lt;/ui_type&gt;&lt;use_scoped_format&gt;false&lt;/use_scoped_format&gt;&lt;/sys_ui_script&gt;&lt;/record_update&gt;</payload>
        <payload_hash>1826527773</payload_hash>
        <record_name>AIAB Chat Button (SP Widget)</record_name>
        <reverted_from/>
        <source>fb79436b835232104d4fccb6feaad310</source>
        <source_table>sys_update_set</source_table>
        <state>previous</state>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-22 22:33:01</sys_created_on>
        <sys_id>a0dd382a832eb2104d4fccb6feaad3e9</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_recorded_at>19be7d6ef490000001</sys_recorded_at>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-22 22:33:01</sys_updated_on>
        <type>UI Script</type>
        <update_guid>a0dd382a092eb2101d5fc97a54a8e3e8</update_guid>
        <update_guid_history>a0dd382a092eb2101d5fc97a54a8e3e8:1826527773,747bf8ae1beab2104a3c4650dde51b58:1896116212,8d29b8ee21eab2107152ec531d344f2f:1326960895,4cb8f4ae2feab21062b2730025a3f5d4:-1880752280,6158f42ea3eab210bce762c1d7dcd2ad:-542513836,07c7f42e8ceab21024d23fe7b46db4e2:122830859,87a7742eaeeab21001978365d92e63d0:-542513836,d5a7342e28eab2107db9d14bd7c4eef7:122830859,c22774eaadeab210217ff65999b29c05:-542513836,c4f6bcaab3eab210570c2e9976c88b55:1818767779</update_guid_history>
    </sys_update_version>
    <sys_metadata_delete action="INSERT_OR_UPDATE">
        <sys_audit_delete/>
        <sys_class_name>sys_metadata_delete</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-22 23:23:18</sys_created_on>
        <sys_db_object display_value="" name="sys_ui_script">sys_ui_script</sys_db_object>
        <sys_id>0bb2cfa00e5b4a5d958e4f075362a371</sys_id>
        <sys_metadata>c0f6f8aa83eab2104d4fccb6feaad3a6</sys_metadata>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>AIAB Chat Button (SP Widget)</sys_name>
        <sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016">0439d1f593948210071230a97bba1016</sys_package>
        <sys_parent/>
        <sys_policy/>
        <sys_scope display_value="AI in a Box">0439d1f593948210071230a97bba1016</sys_scope>
        <sys_scope_delete display_value="">c1a48f6b4a924506a5b1a6becbc665a1</sys_scope_delete>
        <sys_update_name>sys_ui_script_c0f6f8aa83eab2104d4fccb6feaad3a6</sys_update_name>
        <sys_update_version display_value="sys_ui_script_c0f6f8aa83eab2104d4fccb6feaad3a6">a0dd382a832eb2104d4fccb6feaad3e9</sys_update_version>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-22 23:23:18</sys_updated_on>
    </sys_metadata_delete>
</record_update>
