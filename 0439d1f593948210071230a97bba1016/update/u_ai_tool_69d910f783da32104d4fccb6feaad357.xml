<?xml version="1.0" encoding="UTF-8"?><record_update table="u_ai_tool">
    <u_ai_tool action="INSERT_OR_UPDATE">
        <sys_class_name>u_ai_tool</sys_class_name>
        <sys_created_by>opencode</sys_created_by>
        <sys_created_on>2026-01-14 06:52:31</sys_created_on>
        <sys_id>69d910f783da32104d4fccb6feaad357</sys_id>
        <sys_mod_count>23</sys_mod_count>
        <sys_name>search_knowledge</sys_name>
        <sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016">0439d1f593948210071230a97bba1016</sys_package>
        <sys_policy/>
        <sys_scope display_value="AI in a Box">0439d1f593948210071230a97bba1016</sys_scope>
        <sys_update_name>u_ai_tool_69d910f783da32104d4fccb6feaad357</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-02-16 21:04:48</sys_updated_on>
        <u_active>true</u_active>
        <u_description>Search knowledge base articles. Can search by keywords in title or content, by category, or find recently published articles.</u_description>
        <u_execute_in>servicenow</u_execute_in>
        <u_name>search_knowledge</u_name>
        <u_parameters>{
  "type": "object",
  "properties": {
    "query": {
      "type": "string",
      "description": "Search text to find in article title or content"
    },
    "category": {
      "type": "string",
      "description": "Knowledge category name to filter by"
    },
    "published_recently": {
      "type": "boolean",
      "description": "If true, only return articles published in the last 30 days"
    },
    "limit": {
      "type": "integer",
      "description": "Max articles to return (default 5, max 10)"
    }
  },
  "required": [
    "query"
  ]
}</u_parameters>
        <u_script><![CDATA[(function(args, userId) {
    var instanceLink = "https://" + gs.getProperty("instance_name") + ".service-now.com";
    if (typeof args.limit == "undefined") args.limit = 3;
    if (typeof args.query == "undefined") return {
        error: "No query included"
    };

    var kbGR = new GlideRecord("kb_knowledge");
    kbGR.addQuery("workflow_state", "published");
    kbGR.addQuery('IR_AND_OR_QUERY', args.query);

    if (args.category) {
        var catGR = new GlideRecord("kb_category");
        catGR.addQuery("label", "CONTAINS", args.category);
        catGR.setLimit(1);
        catGR.query();
        if (catGR.next()) {
            kbGR.addQuery("kb_category", catGR.getUniqueValue());
        }
    }

    kbGR.orderByDesc("sys_view_count");
    kbGR.setLimit(parseInt(args.limit, 10));
    kbGR.query();

    var articles = [];
    while (kbGR.next()) {
        var text = kbGR.getValue("text");
        var markdown = new global.UtilAIAB().htmlToMarkdown(text);
        // let start at the first instance of the text
        markdown = "**" + args.query + "**" + markdown.split(args.query)[1];
        articles.push({
            number: kbGR.getValue("number"),
            link: instanceLink + "/kb_view.do?sys_kb_id=" + kbGR.getValue('sys_id'),
            title: kbGR.getValue("short_description"),
            category: kbGR.getDisplayValue("kb_category"),
            views: kbGR.getValue("sys_view_count"),
            excerpt: markdown.substring(0, 200) + "..."
        });
    }

    if (articles.length === 0) return {
        found: false,
        message: "No knowledge articles found " + instanceLink + '/kb_knowledge_list.do?sysparm_query=' + kbGR.getEncodedQuery()
    };
    return {
        found: true,
        count: articles.length,
        articles: articles
    };
})(args, userId);]]></u_script>
    </u_ai_tool>
</record_update>
