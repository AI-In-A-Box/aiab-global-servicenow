<?xml version="1.0" encoding="UTF-8"?><record_update table="u_ai_tool">
    <u_ai_tool action="INSERT_OR_UPDATE">
        <sys_class_name>u_ai_tool</sys_class_name>
        <sys_created_by>opencode</sys_created_by>
        <sys_created_on>2026-02-13 06:52:36</sys_created_on>
        <sys_id>d789ba1983c7b2504d4fccb6feaad3e6</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>summarize_sc_request</sys_name>
        <sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016">0439d1f593948210071230a97bba1016</sys_package>
        <sys_policy/>
        <sys_scope display_value="AI in a Box">0439d1f593948210071230a97bba1016</sys_scope>
        <sys_update_name>u_ai_tool_d789ba1983c7b2504d4fccb6feaad3e6</sys_update_name>
        <sys_updated_by>opencode</sys_updated_by>
        <sys_updated_on>2026-02-13 07:01:46</sys_updated_on>
        <u_active>true</u_active>
        <u_description>Summarize this request.</u_description>
        <u_execute_in>servicenow</u_execute_in>
        <u_name>summarize_sc_request</u_name>
        <u_parameters>{
  "type": "object",
  "properties": {
    "sys_id": {
      "type": "string",
      "description": "Record sys_id (sc_request)"
    }
  },
  "required": [
    "sys_id"
  ]
}</u_parameters>
        <u_script><![CDATA[(function(args, userId) {
  try {
    if (!args || !args.sys_id) return { error: 'missing sys_id' };
    var gr = new GlideRecordSecure('sc_request');
    if (!gr.get(args.sys_id)) return { error: 'record not found or access denied' };
    
    var parts = [];
    parts.push('SERVICE REQUEST SUMMARY');
    parts.push('=======================');
    
    if (gr.isValidField('number') && gr.getValue('number')) {
      parts.push('Request Number: ' + gr.getDisplayValue('number'));
    }
    
    if (gr.isValidField('short_description') && gr.getValue('short_description')) {
      parts.push('Short Description: ' + gr.getValue('short_description'));
    }
    
    if (gr.isValidField('opened_by') && gr.getValue('opened_by')) {
      parts.push('Opened By: ' + gr.getDisplayValue('opened_by'));
    }
    
    if (gr.isValidField('requested_for') && gr.getValue('requested_for')) {
      parts.push('Requested For: ' + gr.getDisplayValue('requested_for'));
    }
    
    if (gr.isValidField('request_state') && gr.getValue('request_state')) {
      parts.push('Request State: ' + gr.getDisplayValue('request_state'));
    }
    
    parts.push('');
    parts.push('STATUS');
    parts.push('------');
    if (gr.isValidField('state') && gr.getValue('state')) {
      parts.push('State: ' + gr.getDisplayValue('state'));
    }
    if (gr.isValidField('approval') && gr.getValue('approval')) {
      parts.push('Approval Status: ' + gr.getDisplayValue('approval'));
    }
    
    parts.push('');
    parts.push('DATES');
    parts.push('-----');
    if (gr.isValidField('opened_at') && gr.getValue('opened_at')) {
      parts.push('Opened: ' + gr.getDisplayValue('opened_at'));
    }
    if (gr.isValidField('sys_updated_on') && gr.getValue('sys_updated_on')) {
      parts.push('Last Updated: ' + gr.getDisplayValue('sys_updated_on'));
    }
    
    if (gr.isValidField('description') && gr.getValue('description')) {
      parts.push('');
      parts.push('DESCRIPTION');
      parts.push('-----------');
      parts.push(gr.getValue('description'));
    }
    
    // Get related items (sc_req_item)
    var itemGR = new GlideRecordSecure('sc_req_item');
    itemGR.addQuery('request', args.sys_id);
    itemGR.query();
    if (itemGR.hasNext()) {
      parts.push('');
      parts.push('REQUESTED ITEMS');
      parts.push('---------------');
      while (itemGR.next()) {
        var itemLine = '';
        if (itemGR.isValidField('number') && itemGR.getValue('number')) {
          itemLine += itemGR.getDisplayValue('number') + ': ';
        }
        if (itemGR.isValidField('cat_item') && itemGR.getValue('cat_item')) {
          itemLine += itemGR.getDisplayValue('cat_item');
        }
        if (itemGR.isValidField('state') && itemGR.getValue('state')) {
          itemLine += ' [' + itemGR.getDisplayValue('state') + ']';
        }
        if (itemLine) parts.push('- ' + itemLine);
      }
    }
    
    // Get approvals for this request
    var approvalGR = new GlideRecordSecure('sysapproval_approver');
    approvalGR.addQuery('sysapproval', args.sys_id);
    approvalGR.query();
    if (approvalGR.hasNext()) {
      parts.push('');
      parts.push('APPROVALS');
      parts.push('---------');
      while (approvalGR.next()) {
        var approver = approvalGR.getDisplayValue('approver') || 'Unknown';
        var state = approvalGR.getDisplayValue('state') || 'Pending';
        parts.push('- ' + approver + ': ' + state);
      }
    }
    
    // Comments
    if (gr.isValidField('comments') && gr.comments) {
      var comments = gr.comments.getJournalEntry(5);
      if (comments && comments.length > 0) {
        parts.push('');
        parts.push('RECENT COMMENTS');
        parts.push('---------------');
        for (var i = 0; i < Math.min(comments.length, 5); i++) {
          parts.push(comments[i]);
        }
      }
    }
    
    // Work notes
    if (gr.isValidField('work_notes') && gr.work_notes) {
      var workNotes = gr.work_notes.getJournalEntry(5);
      if (workNotes && workNotes.length > 0) {
        parts.push('');
        parts.push('WORK NOTES');
        parts.push('----------');
        for (var j = 0; j < Math.min(workNotes.length, 5); j++) {
          parts.push(workNotes[j]);
        }
      }
    }
    
    var rendered = parts.join('\n');
    var prompt = 'You are a helpful assistant. Summarize the following service request concisely, highlighting the purpose, current status, and any items being requested.\n\n' + rendered;
    
    return { 
      found: true, 
      prompt: prompt, 
      rendered: rendered,
      record_number: gr.getDisplayValue('number') || args.sys_id
    };
    
  } catch(err) {
    return { error: err.message || String(err) };
  }
})(args, userId);]]></u_script>
    </u_ai_tool>
</record_update>
