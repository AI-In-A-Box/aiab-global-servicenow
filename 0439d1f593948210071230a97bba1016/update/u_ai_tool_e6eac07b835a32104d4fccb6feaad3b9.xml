<?xml version="1.0" encoding="UTF-8"?><record_update table="u_ai_tool">
    <u_ai_tool action="INSERT_OR_UPDATE">
        <sys_class_name>u_ai_tool</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-14 05:47:46</sys_created_on>
        <sys_id>e6eac07b835a32104d4fccb6feaad3b9</sys_id>
        <sys_mod_count>36</sys_mod_count>
        <sys_name>get_incident</sys_name>
        <sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016">0439d1f593948210071230a97bba1016</sys_package>
        <sys_policy/>
        <sys_scope display_value="AI in a Box">0439d1f593948210071230a97bba1016</sys_scope>
        <sys_update_name>u_ai_tool_e6eac07b835a32104d4fccb6feaad3b9</sys_update_name>
        <sys_updated_by>opencode</sys_updated_by>
        <sys_updated_on>2026-02-16 07:16:49</sys_updated_on>
        <u_active>true</u_active>
        <u_description>Search for incidents in ServiceNow. Can search by number, caller, assigned user, state, priority, or find recent incidents. Returns up to 5 matching incidents. IMPORTANT: The 'link' field in the response contains RELATIVE URLs starting with '/'. You MUST preserve these as relative links - do NOT add domain names or convert to absolute URLs.</u_description>
        <u_execute_in>servicenow</u_execute_in>
        <u_name>get_incident</u_name>
        <u_parameters>{
  "type": "object",
  "properties": {
    "number": {
      "type": "string",
      "description": "Incident number like INC0000001"
    },
    "caller": {
      "type": "string",
      "description": "Name of the person who reported the incident"
    },
    "assigned_to": {
      "type": "string",
      "description": "Name of the person assigned to the incident"
    },
    "assignment_group": {
      "type": "string",
      "description": "Name of the group assigned to the incident"
    },
    "state": {
      "type": "string",
      "enum": [
        "new",
        "in_progress",
        "on_hold",
        "resolved",
        "closed"
      ],
      "description": "Incident state"
    },
    "priority": {
      "type": "string",
      "enum": [
        "1",
        "2",
        "3",
        "4",
        "5"
      ],
      "description": "Priority level (1=Critical, 5=Planning)"
    },
    "opened_today": {
      "type": "boolean",
      "description": "If true, only return incidents opened today"
    },
    "short_description_contains": {
      "type": "string",
      "description": "Search for text in the short description"
    },
    "limit": {
      "type": "integer",
      "description": "Max number of incidents to return (default 5, max 9)"
    }
  },
  "required": []
}</u_parameters>
        <u_script><![CDATA[(function(args, userId) {
    var incidentRecord = new GlideRecordSecure("incident");

    if (args.number) {
        incidentRecord.addQuery("number", args.number);
    }
    if (args.caller) {
        incidentRecord.addQuery("caller_id.name", "LIKE", args.caller);
    }
    if (args.assigned_to) {
        incidentRecord.addQuery("assigned_to.name", "LIKE", args.assigned_to);
    }
    if (args.assignment_group) {
        incidentRecord.addQuery("assignment_group", "LIKE", args.assignment_group);
    }
    if (args.state) {
        var stateMap = { 
            "new": 1,
            "in_progress": 2,
            "on_hold": 3,
            "resolved": 6,
            "closed": 7 
        };
        if (stateMap[args.state.toLowerCase()]) {
            incidentRecord.addQuery("state", stateMap[args.state.toLowerCase()]);
        }
    }
    if (args.priority) {
        incidentRecord.addQuery("priority", args.priority);
    }
    if (args.opened_today === true) {
        incidentRecord.addQuery("opened_at", ">=", gs.beginningOfToday());
    }
    if (args.short_description_contains) {
        incidentRecord.addQuery("short_description", "CONTAINS", args.short_description_contains);
    }

    incidentRecord.orderByDesc("opened_at");
    incidentRecord.setLimit(Math.min(args.limit || 5, 10));
    incidentRecord.query();

    var incidents = [];
    while (incidentRecord.next()) {
        var incident = {
            number: "" + incidentRecord.number,
            short_description: "" + incidentRecord.short_description,
            state: incidentRecord.getDisplayValue("state"),
            priority: incidentRecord.getDisplayValue("priority"),
            assigned_to: incidentRecord.getDisplayValue("assigned_to"),
            opened_at: "" + incidentRecord.opened_at,
            link: "/incident.do?sys_id=" + incidentRecord.getValue("sys_id")
        };
        // Only include caller_id if user can read it
        if (incidentRecord.caller_id.canRead()) {
            incident.caller_id = incidentRecord.getDisplayValue("caller_id");
        }
        incidents.push(incident);
    }

    if (incidents.length === 0) {
        return { found: false, count: 0, message: "No incidents found" };
    }
    if (args.number && incidents.length === 1) {
        incidentRecord.get("number", args.number);
        var singleIncident = {
            number: "" + incidentRecord.number,
            short_description: "" + incidentRecord.short_description,
            description: "" + incidentRecord.description,
            state: incidentRecord.getDisplayValue("state"),
            priority: incidentRecord.getDisplayValue("priority"),
            assigned_to: incidentRecord.getDisplayValue("assigned_to"),
            opened_at: "" + incidentRecord.opened_at,
            link: "/incident.do?sys_id=" + incidentRecord.getValue("sys_id")
        };
        // Only include caller_id if user can read it
        if (incidentRecord.caller_id.canRead()) {
            singleIncident.caller_id = incidentRecord.getDisplayValue("caller_id");
        }
        return { found: true, incident: singleIncident };
    }
    return { found: true, count: incidents.length, incidents: incidents };
})(args, userId);]]></u_script>
    </u_ai_tool>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>e6eac07b835a32104d4fccb6feaad3b9</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-14 05:47:45</sys_created_on>
        <sys_id>410b047b835a32104d4fccb6feaad310</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-22 15:23:40</sys_updated_on>
        <table>u_ai_tool</table>
        <use_es_latest>false</use_es_latest>
    </sys_es_latest_script>
</record_update>
