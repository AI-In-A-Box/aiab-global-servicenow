<?xml version="1.0" encoding="UTF-8"?><record_update table="u_ai_tool">
    <u_ai_tool action="INSERT_OR_UPDATE">
        <sys_class_name>u_ai_tool</sys_class_name>
        <sys_created_by>opencode</sys_created_by>
        <sys_created_on>2026-01-14 06:52:37</sys_created_on>
        <sys_id>8bd9dcf783da32104d4fccb6feaad3e8</sys_id>
        <sys_mod_count>10</sys_mod_count>
        <sys_name>search_catalog</sys_name>
        <sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016">0439d1f593948210071230a97bba1016</sys_package>
        <sys_policy/>
        <sys_scope display_value="AI in a Box">0439d1f593948210071230a97bba1016</sys_scope>
        <sys_update_name>u_ai_tool_8bd9dcf783da32104d4fccb6feaad3e8</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-02-13 08:00:20</sys_updated_on>
        <u_active>true</u_active>
        <u_description>Search service catalog items that users can request. Can search by name, description, or category</u_description>
        <u_execute_in>servicenow</u_execute_in>
        <u_name>search_catalog</u_name>
        <u_parameters>{
  "type": "object",
  "properties": {
    "query": {
      "type": "string",
      "description": "Search text to find in catalog item name or description"
    },
    "category": {
      "type": "string",
      "description": "Catalog category name to filter by"
    },
    "limit": {
      "type": "integer",
      "description": "Max items to return (default 5, max 10)"
    },
    "portal_suffix": {
      "type": "string",
      "description": "The portal suffix e.g. sp of service-now.com/sp the user is in and blank for core ui"
    }
  },
  "required": []
}</u_parameters>
        <u_script><![CDATA[(function(args, userId) {
	var instanceLink = 'https://' + gs.getProperty('instance_name');
	instanceLink += '.service-now.com';
    var gr = new GlideRecord("sc_cat_item");
    gr.addQuery("active", true);

    if (args.query) {
        var qc = gr.addQuery("name", "CONTAINS", args.query);
        qc.addOrCondition("short_description", "CONTAINS", args.query);
        qc.addOrCondition("description", "CONTAINS", args.query);
    }
    if (args.category) {
        var catGR = new GlideRecord("sc_category");
        catGR.addQuery("title", "CONTAINS", args.category);
        catGR.setLimit(1);
        catGR.query();
        if (catGR.next()) gr.addQuery("category", catGR.getUniqueValue());
    }


    gr.orderByDesc("sys_mod_count");
    gr.setLimit(Math.min(args.limit || 5, 10));
    gr.query();

    var items = [];
    while (gr.next()) {
		var link = false;
		if(args.portal_suffix){
			link = instanceLink + '/' + args.portal_suffix + '?id=sc_cat_item&sys_id=' + gr.getValue('sys_id');
		} else {
			link = instanceLink + '/now/nav/ui/classic/params/target/com.glideapp.servicecatalog_cat_item_view.do?v=1&sysparm_id=' + gr.getValue('sys_id');
			// /now/nav/ui/classic/params/target/com.glideapp.servicecatalog_cat_item_view.do?v=1&sysparm_id=f0caa23e97c2019021983d1e6253af9a&sysparm_link_parent=109f0438c6112276003ae8ac13e7009d&sysparm_catalog=e0d08b13c3330100c8b837659bba8fb4&sysparm_catalog_view=catalog_default&sysparm_view=catalog_default
		}
	
        items.push({
            name: "" + gr.name,
            short_description: "" + gr.short_description,
            category: gr.getDisplayValue("category"),
            price: "" + gr.price,
			link: link
        });
    }

    if (items.length === 0) return { found: false, message: "No catalog items found" };
    return { found: true, count: items.length, items: items };
})(args, userId);]]></u_script>
    </u_ai_tool>
</record_update>
