<?xml version="1.0" encoding="UTF-8"?><record_update table="u_ai_tool">
    <u_ai_tool action="INSERT_OR_UPDATE">
        <sys_class_name>u_ai_tool</sys_class_name>
        <sys_created_by>opencode</sys_created_by>
        <sys_created_on>2026-02-13 06:52:48</sys_created_on>
        <sys_id>4a99325983c7b2504d4fccb6feaad32d</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name>summarize_incident</sys_name>
        <sys_package display_value="AI in a Box" source="0439d1f593948210071230a97bba1016">0439d1f593948210071230a97bba1016</sys_package>
        <sys_policy/>
        <sys_scope display_value="AI in a Box">0439d1f593948210071230a97bba1016</sys_scope>
        <sys_update_name>u_ai_tool_4a99325983c7b2504d4fccb6feaad32d</sys_update_name>
        <sys_updated_by>opencode</sys_updated_by>
        <sys_updated_on>2026-02-13 07:02:10</sys_updated_on>
        <u_active>true</u_active>
        <u_description>Summarize an incident record.</u_description>
        <u_execute_in>servicenow</u_execute_in>
        <u_name>summarize_incident</u_name>
        <u_parameters>{
  "type": "object",
  "properties": {
    "sys_id": {
      "type": "string",
      "description": "Record sys_id (incident)"
    }
  },
  "required": [
    "sys_id"
  ]
}</u_parameters>
        <u_script><![CDATA[(function(args, userId) {
  try {
    if (!args || !args.sys_id) return { error: 'missing sys_id' };
    var gr = new GlideRecordSecure('incident');
    if (!gr.get(args.sys_id)) return { error: 'record not found or access denied' };
    
    var parts = [];
    parts.push('INCIDENT SUMMARY');
    parts.push('================');
    
    if (gr.isValidField('number') && gr.getValue('number')) {
      parts.push('Incident Number: ' + gr.getDisplayValue('number'));
    }
    
    if (gr.isValidField('short_description') && gr.getValue('short_description')) {
      parts.push('Short Description: ' + gr.getValue('short_description'));
    }
    
    parts.push('');
    parts.push('REPORTER & AFFECTED');
    parts.push('-------------------');
    if (gr.isValidField('caller_id') && gr.getValue('caller_id')) {
      parts.push('Caller: ' + gr.getDisplayValue('caller_id'));
    }
    if (gr.isValidField('contact_type') && gr.getValue('contact_type')) {
      parts.push('Contact Method: ' + gr.getDisplayValue('contact_type'));
    }
    if (gr.isValidField('u_affected_user') && gr.getValue('u_affected_user')) {
      parts.push('Affected User: ' + gr.getDisplayValue('u_affected_user'));
    }
    if (gr.isValidField('u_affected_ci') && gr.getValue('u_affected_ci')) {
      parts.push('Affected CI: ' + gr.getDisplayValue('u_affected_ci'));
    }
    
    parts.push('');
    parts.push('STATUS & PRIORITY');
    parts.push('-----------------');
    if (gr.isValidField('state') && gr.getValue('state')) {
      parts.push('State: ' + gr.getDisplayValue('state'));
    }
    if (gr.isValidField('priority') && gr.getValue('priority')) {
      parts.push('Priority: ' + gr.getDisplayValue('priority'));
    }
    if (gr.isValidField('impact') && gr.getValue('impact')) {
      parts.push('Impact: ' + gr.getDisplayValue('impact'));
    }
    if (gr.isValidField('urgency') && gr.getValue('urgency')) {
      parts.push('Urgency: ' + gr.getDisplayValue('urgency'));
    }
    
    parts.push('');
    parts.push('ASSIGNMENT');
    parts.push('----------');
    if (gr.isValidField('assignment_group') && gr.getValue('assignment_group')) {
      parts.push('Assignment Group: ' + gr.getDisplayValue('assignment_group'));
    }
    if (gr.isValidField('assigned_to') && gr.getValue('assigned_to')) {
      parts.push('Assigned To: ' + gr.getDisplayValue('assigned_to'));
    }
    
    parts.push('');
    parts.push('TIMELINE');
    parts.push('--------');
    if (gr.isValidField('opened_at') && gr.getValue('opened_at')) {
      parts.push('Opened: ' + gr.getDisplayValue('opened_at'));
    }
    if (gr.isValidField('resolved_at') && gr.getValue('resolved_at')) {
      parts.push('Resolved: ' + gr.getDisplayValue('resolved_at'));
    }
    if (gr.isValidField('closed_at') && gr.getValue('closed_at')) {
      parts.push('Closed: ' + gr.getDisplayValue('closed_at'));
    }
    if (gr.isValidField('sys_updated_on') && gr.getValue('sys_updated_on')) {
      parts.push('Last Updated: ' + gr.getDisplayValue('sys_updated_on'));
    }
    if (gr.isValidField('calendar_duration') && gr.getValue('calendar_duration')) {
      parts.push('Duration: ' + gr.getDisplayValue('calendar_duration'));
    }
    
    if (gr.isValidField('description') && gr.getValue('description')) {
      parts.push('');
      parts.push('FULL DESCRIPTION');
      parts.push('----------------');
      parts.push(gr.getValue('description'));
    }
    
    // Close notes if resolved/closed
    var stateVal = parseInt(gr.getValue('state') || '0');
    if ((stateVal === 6 || stateVal === 7) && gr.isValidField('close_notes') && gr.getValue('close_notes')) {
      parts.push('');
      parts.push('RESOLUTION / CLOSE NOTES');
      parts.push('------------------------');
      parts.push(gr.getValue('close_notes'));
    }
    
    // Root cause if available
    if (gr.isValidField('u_root_cause') && gr.getValue('u_root_cause')) {
      parts.push('');
      parts.push('ROOT CAUSE');
      parts.push('----------');
      parts.push(gr.getValue('u_root_cause'));
    }
    
    // Work notes (most important for incident context)
    if (gr.isValidField('work_notes') && gr.work_notes) {
      var workNotes = gr.work_notes.getJournalEntry(10);
      if (workNotes && workNotes.length > 0) {
        parts.push('');
        parts.push('WORK NOTES / ACTIVITY (Recent 10)');
        parts.push('----------------------------------');
        for (var j = 0; j < Math.min(workNotes.length, 10); j++) {
          parts.push(workNotes[j]);
          if (j < workNotes.length - 1) parts.push('');
        }
      }
    }
    
    // Additional comments (customer-facing)
    if (gr.isValidField('comments') && gr.comments) {
      var comments = gr.comments.getJournalEntry(5);
      if (comments && comments.length > 0) {
        parts.push('');
        parts.push('ADDITIONAL COMMENTS (Recent 5)');
        parts.push('------------------------------');
        for (var i = 0; i < Math.min(comments.length, 5); i++) {
          parts.push(comments[i]);
        }
      }
    }
    
    // Related incidents
    if (gr.isValidField('rfc') && gr.getValue('rfc')) {
      parts.push('');
      parts.push('RELATED CHANGE');
      parts.push('--------------');
      var rfcGR = new GlideRecordSecure('change_request');
      if (rfcGR.get(gr.getValue('rfc'))) {
        parts.push(rfcGR.getDisplayValue('number') + ': ' + rfcGR.getDisplayValue('short_description'));
      }
    }
    
    var rendered = parts.join('\n');
    var prompt = 'You are an assistant proficient in data analysis and incident management. Create a clear summary of the following incident with a bulleted list covering: the issue, timeline, current status, and recent actions. Be concise and actionable. No Yapping.\n\n' + rendered;
    
    return { 
      found: true, 
      prompt: prompt, 
      rendered: rendered,
      record_number: gr.getDisplayValue('number') || args.sys_id
    };
    
  } catch(err) {
    return { error: err.message || String(err) };
  }
})(args, userId);]]></u_script>
    </u_ai_tool>
</record_update>
